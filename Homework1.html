<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>Inventorying Items</title>
  <script src="https://code.jquery.com/jquery.min.js"></script>
  <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet" type="text/css" />
  <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.1.0.js"></script>
  <style>
    body{
      margin-left: 50px;
      margin-top: 50px;
    }
    span{
      margin-bottom: 50px;
    }
    div{
      margin-bottom: 30px;
      margin-top: 30px;
    }
  </style>
</head>
<body>
  <span><h4>Name:</h4><input id="nameInput"></input></span><br>
  <span><h4>Price:</h4><input id="priceInput"></input></span><br>
  <div>
    <h4>Tags:</h4>
    <input type="checkbox" id="dairyTagCheckbox" name="Dairy"/> Dairy <br>
    <input type="checkbox" id="wheatTagCheckbox" name="Wheat"/> Wheat <br>
    <input type="checkbox" id="coldCutsTagCheckbox" name="Cold Cuts"/> Cold Cuts <br>
    <input type="checkbox" id="fruitsAndVegetablesTagCheckbox" name="Fruits And Vegetables"/> Friuts And Vegetables <br>
  </div>
  <div>
    <h4>Stores:</h4>
    <input type="checkbox" id="stopAndShopStoreCheckbox" name="Stop And Shop"/> Stop And Shop <br>
    <input type="checkbox" id="targetStoreCheckbox" name="Target"/> Target <br>
    <input type="checkbox" id="walmartStoreCheckbox" name="Walmart"/> Walmart <br>
    <input type="checkbox" id="keyFoodStoreCheckbox" name="Key Food"/> Key Food <br>
  </div>
  <button class="btn btn-default" id="submitButton" >Submit</button>
  <table id="productTable" class="table"></table>
  <script>
    const allProducts = [];

    class Product{
      constructor(name, price, tags, stores) {
        this.name = name;
        this.price = price;
        this.tags = tags;
        this.stores = stores;
      }
      addToTable(){
        $("#productTable").append("<tr><td>" + this.name + "</td><td>" + this.price + "</td><td>" + this.tags.join(", ") + "</td><td>" + this.stores.join(", ") + "</td></tr>");
      }
    }
    const tagCheckboxes = [$("#dairyTagCheckbox"), $("#wheatTagCheckbox"), $("#coldCutsTagCheckbox"), $("#fruitsAndVegetablesTagCheckbox")];
    const storeCheckboxes = [$("#stopAndShopStoreCheckbox"), $("#targetStoreCheckbox"), $("#walmartStoreCheckbox"), $("#keyFoodStoreCheckbox")];

    $("#submitButton").click( function (){
      const tags = [];
      const stores = [];
      for(let currentCheckbox of tagCheckboxes){
        if(currentCheckbox.is(":checked")){
          tags.push(currentCheckbox.attr("name"));
        }
      }
      for(let currentCheckbox of storeCheckboxes){
        if(currentCheckbox.is(":checked")){
          stores.push(currentCheckbox.attr("name"));
        }
      }
      if(tags.length > 0 && stores.length > 0){
        const data = {
          "name":$("#nameInput").val(),
          "price":$("#priceInput").val(),
          "tags": tags.join(", "),
          "stores": stores.join(", ")
        };
        parseRawProductData(data);
        postToSparkfun(data);
      }
    });

    function getInitalProducts(){
      $.ajax({
        type: "GET",
        url: "http://data.sparkfun.com/output/5J4Ejm2yVdCyNOrQVmo2.json",
        success: (response) => {
          for(let product of response){
            parseRawProductData(product);
          }
        }
      })
    }

    function postToSparkfun(data){
      $.ajax({
        url: "http://data.sparkfun.com/input/5J4Ejm2yVdCyNOrQVmo2",
        headers: {
          "Phant-Private-Key": "7BoVgGw7leSkmr7bnaMy"
        },
        method: "POST",
        dataType: "json",
        data: data,
        success: function(data) {
        }
      })
    }

    function parseRawProductData(data){
      const newProduct = new Product(data.name, data.price, data.tags.split(", "), data.stores.split(", "));
      allProducts.push(newProduct);
      newProduct.addToTable();
    }

    getInitalProducts();
  </script>
</body>
</html>
